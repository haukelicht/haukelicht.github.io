<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>Enhancing {manifestoR} data objects: A short tutorial using the Swiss manifesto corpus. &#8211; Hauke Licht</title> <meta name="description" content="Hi! I'm a Ph.D. student of Political Science at the University of Zurich."> <meta name="keywords" content="data wrangling, manifesto data, Manifestos Project, R, manifestoR, manifestoEnhanceR, XML"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/hauke_licht_front_color_narrow_small.jpg"> <meta name="twitter:title" content="Enhancing {manifestoR} data objects: A short tutorial using the Swiss manifesto corpus."> <meta name="twitter:description" content="In this post, I introduce my manifestoEnhanceR package and apply it (i) to recover document structure from Swiss parties’ manifesto as provided by the Comparative Manifesto Project throught their manifestoR package, and (ii) to convert manifestR obejcts to XML documents."> <meta name="twitter:site" content="@hauke_licht"> <meta name="twitter:creator" content="@hauke_licht"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Enhancing {manifestoR} data objects: A short tutorial using the Swiss manifesto corpus."> <meta property="og:description" content="In this post, I introduce my manifestoEnhanceR package and apply it (i) to recover document structure from Swiss parties’ manifesto as provided by the Comparative Manifesto Project throught their manifestoR package, and (ii) to convert manifestR obejcts to XML documents."> <meta property="og:url" content="http://localhost:4000/manifestoR-data-structure-to-XML-tutorial/"> <meta property="og:site_name" content="Hauke Licht"> <meta property="og:image" content="http://localhost:4000/assets/img/hauke_licht_front_color_narrow_small.jpg"> <link rel="canonical" href="http://localhost:4000/manifestoR-data-structure-to-XML-tutorial/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Hauke Licht Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/hauke_licht.png" /> <!-- <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> --> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/bg_dark.jpg); }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/hauke_licht_front_color_narrow_small.jpg" alt="Hauke Licht photo" class="author-photo"> <h4>Hauke Licht</h4> <p>Hi! I'm a Ph.D. student of Political Science at the University of Zurich.</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:hauke.licht@uzh.ch" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://twitter.com/hauke_licht" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://github.com/haukelicht" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> <li> <a href="https://www.ipz.uzh.ch/en/institut/mitarbeitende/staff/licht.html" target="_blank" rel="noopener noreferrer"><i class="fa fa-university"></i> Work</a> </li> <li> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="http://localhost:4000/research/">Research</a> </li> <li> <a href="http://localhost:4000/cv/">CV</a> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">All Posts</a></li> <li><a href="http://localhost:4000/tags/">All Tags</a></li> </ul> </li> <li> <a href="http://localhost:4000/credit/">Credits</a> </li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Enhancing {manifestoR} data objects: A short tutorial using the Swiss manifesto corpus.</h1> <h4>07 Mar 2019</h4> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p>In this short tutorial, I show how functions provided by my <code class="highlighter-rouge">manifestoEnhanceR</code> package can be used to convert a large batch of manifesto documents into <a href="https://www.w3schools.com/xml/xml_whatis.asp">XML</a> documents enriched with document structure (headers, sentences, quasi-sentence nesting) and meta data (e.g, manifesto title or quasi-sentence CMP code).</p> <p>Before getting started, a short note on why one would want to convert <code class="highlighter-rouge">manifestoR</code> data object to XML files seems to be in order, but you can skip this note and fo directly to section <a href="#the-manifestoenhancer-package-converting-swiss-manifestos-to-xml-documents">2</a>.</p> <h2 id="where-all-began">Where all began</h2> <p>If you look at a manifesto in its print or online version, it starts with a title, then comes an introduction or summary of key points, following by a number of chapters that comprise many more sentences.</p> <p>This document structure is not reflected in the format in which the Manifesto Project makes its data available: The CMP project distributes its annotated manifesto data in a tabular format at the “quasi-sentence” level (full sentences or parts thereof).</p> <p>While this is not a problem if you are merely interested in their codings, it can be a problem in case you want to use the manifesto texts for other puporses, such as topic modeling or for training a word embedding model.<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> On a more general note, I think that data fromats should be back and forward compatible, because this allows many ways of aggregating them. This seems to be particularly important in the case of text data, where different ways of analyzing it perform differently on different levels of analyses (the whole document, chapters, paragraph, sentences, words).</p> <h3 id="a-ray-of-hope">A ray of hope</h3> <p>Now, it turns out that while paragraph structure cannot be recovered from the CMP’S tabular data, we can infer sentences and chapter structure by combining the text of quasi-sentences and their codings.</p> <p>I learned about this on Twitter, when <a href="https://twitter.com/hauke_licht/status/1234781054780788738">asking for help</a> with the data wrangling problem discussed above:</p> <p>My friend Anna gave me a first great hint: one could use the CMP code “H” to detect chapter headings and thereby map quasi-sentences m:1 to chapters.</p> <div class="jekyll-twitter-plugin">
<blockquote class="twitter-tweet">
<p lang="en" dir="ltr">Chapter titles have "H" instead of a topic code in the topic column (at least for the German manifestos that I'm currently working with)</p>— Anna Adendorf (<a href="https://github.com/annaadendorf" class="user-mention">@annaadendorf</a>) <a href="https://twitter.com/annaadendorf/status/1234831169700667394?ref_src=twsrc%5Etfw">March 3, 2020</a>
</blockquote> <script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> </div> <p>The CMP colleagues followed-up on this, suggesting that in addition to using the “H” codes, ‘one could also look for entries coded as NA in between entries with a proper cmp_code.’</p> <div class="jekyll-twitter-plugin">
<blockquote class="twitter-tweet">
<p lang="en" dir="ltr">As a possible workaround for detecting headings: for those documents without H-coding, one could also look for entries coded as NA in between entries with a proper cmp_code. Those could signal a heading and could help to restore some of the original structure. (3)</p>— Manifesto Project (<a href="https://github.com/manifesto_proj" class="user-mention">@manifesto_proj</a>) <a href="https://twitter.com/manifesto_proj/status/1235547623244824582?ref_src=twsrc%5Etfw">March 5, 2020</a>
</blockquote> <script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> </div> <h2 id="the-manifestoenhancer-package-converting-swiss-manifestos-to-xml-documents">The <code class="highlighter-rouge">manifestoEnhanceR</code> package: Converting swiss manifestos to XML documents</h2> <p>Hence I wrote an R package to infer document structure from quasi-sentence level features in <code class="highlighter-rouge">manifestoR</code> data objects, and to convert the enhanced data to XML documents: <code class="highlighter-rouge">manifestoEnhanceR</code>. When I write “enhancing” <code class="highlighter-rouge">manifestoR</code> objects, I mean reconstructing a manifestos document structure.</p> <p>In what follows, I use functions provided by the <code class="highlighter-rouge">manifestoEnhanceR</code> package to convert the entire Swiss manifesto corpus to XML documents. You’ll be guided through the process of</p> <ol> <li>querying manifestos from the Manifesto Project API,</li> <li>covnerting the <code class="highlighter-rouge">manifestoR</code> package’s custom data objects into a tidy data format (i.e., a data frame),</li> <li>enhancing manifesto data frames with text-level information (e.g., quasi-sentence and chapter numbers), and</li> <li>converting the enhanced manifesto data frames to XML documents.</li> </ol> <h3 id="step-0-loading-required-pacakges">Step 0: Loading required pacakges</h3> <p>Load all required pacakges.</p> <p>The <code class="highlighter-rouge">manifestoEnhanceR</code> package is currently only available via GitHub: https://github.com/haukelicht/manifestoEnhanceR</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### if not installed: `install.packages("manifestoR")`</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">manifestoR</span><span class="p">)</span><span class="w">
</span><span class="c1">### if not installed: `devtools::install_github("haukelicht/manifestoEnhanceR)`</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">manifestoEnhanceR</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">purrr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">xml2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rvest</span><span class="p">)</span></code></pre></figure> <h3 id="step-1-load-manifesto-data">Step 1: Load manifesto data</h3> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### set Manifesto Project API key (see `?mp_setapikey`)</span><span class="w">
</span><span class="n">mp_setapikey</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">Sys.getenv</span><span class="p">(</span><span class="s2">"SECRETS_PATH"</span><span class="p">),</span><span class="w"> </span><span class="s2">"manifesto_apikey.txt"</span><span class="p">))</span><span class="w"> </span></code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### get CMP party-year data</span><span class="w">
</span><span class="n">cmp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mp_maindataset</span><span class="p">(</span><span class="n">south_america</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## Connecting to Manifesto Project DB API... 
## Connecting to Manifesto Project DB API... corpus version: 2019-2</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### subset to Swiss configurations</span><span class="w">
</span><span class="n">ch_configs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cmp</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">countryname</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Switzerland"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span><span class="w">

</span><span class="c1">### get Swiss manifestos</span><span class="w">
</span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mp_corpus</span><span class="p">(</span><span class="n">countryname</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Switzerland"</span><span class="p">,</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## Connecting to Manifesto Project DB API... 
## Connecting to Manifesto Project DB API... corpus version: 2019-2 
## Connecting to Manifesto Project DB API... corpus version: 2019-2 
## Connecting to Manifesto Project DB API... corpus version: 2019-2</code></pre></figure> <h3 id="step-2-conversion-to-tidy-data">Step 2: Conversion to tidy data</h3> <p>The object <code class="highlighter-rouge">ch</code> is a “ManifestoCorpus” object, which is essentially a list “ManifestoDocument” objects with some additional fancy attributes.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="nf">class</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "ManifestoCorpus" "VCorpus"         "Corpus"</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">str</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## List of 2
##  $ 43110_198710:List of 2
##  $ 43110_199110:List of 2
##  - attr(*, "class")= chr [1:3] "ManifestoCorpus" "VCorpus" "Corpus"</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">lapply</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">class</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## $`43110_198710`
## [1] "ManifestoDocument" "PlainTextDocument" "TextDocument"     
## 
## $`43110_199110`
## [1] "ManifestoDocument" "PlainTextDocument" "TextDocument"</code></pre></figure> <p>We can tidy this up (i.e., convert it to a long tibble) by applying the first <code class="highlighter-rouge">manifestoEnhanceR</code> function we encounter in this tutorial: <code class="highlighter-rouge">as_tibble.ManifestoCorpus</code>.<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup></p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">man_dfs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as_tibble</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span><span class="w">
</span><span class="n">glimpse</span><span class="p">(</span><span class="n">man_dfs</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## Observations: 94
## Variables: 17
## $ manifesto_id                &lt;chr&gt; "43110_198710", "43110_199110", "43110_19…
## $ party                       &lt;dbl&gt; 43110, 43110, 43110, 43110, 43110, 43110,…
## $ date                        &lt;dbl&gt; 198710, 199110, 199510, 199910, 200310, 2…
## $ language                    &lt;chr&gt; "german", "german", "german", "german", "…
## $ source                      &lt;chr&gt; "CEMP", "CEMP", "CEMP", "MARPOR", "MARPOR…
## $ has_eu_code                 &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE,…
## $ is_primary_doc              &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE,…
## $ may_contradict_core_dataset &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE,…
## $ md5sum_text                 &lt;chr&gt; "b847c70ef9be9933216708916f3583ff", "24b4…
## $ url_original                &lt;chr&gt; NA, NA, NA, "/down/originals/43110_1999.p…
## $ md5sum_original             &lt;chr&gt; NA, NA, NA, "CURRENTLY_UNAVAILABLE", "CUR…
## $ annotations                 &lt;lgl&gt; FALSE, FALSE, FALSE, TRUE, TRUE, TRUE, TR…
## $ handbook                    &lt;chr&gt; NA, NA, NA, "1", NA, "4", "4", "5", "4", …
## $ is_copy_of                  &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ title                       &lt;chr&gt; "Plattform des Grünen Bündnisses", "Progr…
## $ id                          &lt;chr&gt; "43110_198710", "43110_199110", "43110_19…
## $ data                        &lt;list&gt; [&lt;tbl_df[1 x 3]&gt;, &lt;tbl_df[1 x 3]&gt;, &lt;tbl_…</code></pre></figure> <p><code class="highlighter-rouge">man_dfs</code> is a <code class="highlighter-rouge">tibble</code> (a <a href="https://cran.r-project.org/web/packages/tibble/vignettes/tibble.html" title="Tibbles">fancy dataframe</a>) with a <a href="https://jennybc.github.io/purrr-tutorial/ls13_list-columns.html" title="List colums">list-column</a> called “data”. For each row, column data contains a manifesto tibble.</p> <p>To this manifesto-level tibble, we can left-join manifesto- and party-level data:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">man_sents</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">man_dfs</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">left_join</span><span class="p">(</span><span class="w">
    </span><span class="n">ch_configs</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
      </span><span class="n">transmute</span><span class="p">(</span><span class="w">
        </span><span class="n">manifesto_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">party</span><span class="p">,</span><span class="w"> </span><span class="s2">"_"</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">)</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">party</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">partyname</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">partyabbrev</span><span class="w">
      </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
      </span><span class="n">unique</span><span class="p">()</span><span class="w">
  </span><span class="p">)</span></code></pre></figure> <h3 id="step-3-define-some-test-cases">Step 3: Define some test cases</h3> <p>To illustrate the other <code class="highlighter-rouge">manifestoEnhanceR</code> functions, we take four manifestos from the above corpus, each with some particular features (as commented below).</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">test1_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unnest</span><span class="p">(</span><span class="n">filter</span><span class="p">(</span><span class="n">man_sents</span><span class="p">,</span><span class="w"> </span><span class="n">manifesto_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"43120_201110"</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w">
</span><span class="n">test2_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unnest</span><span class="p">(</span><span class="n">filter</span><span class="p">(</span><span class="n">man_sents</span><span class="p">,</span><span class="w"> </span><span class="n">manifesto_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"43110_198710"</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w">
</span><span class="n">test3_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unnest</span><span class="p">(</span><span class="n">filter</span><span class="p">(</span><span class="n">man_sents</span><span class="p">,</span><span class="w"> </span><span class="n">manifesto_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"43110_199910"</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w">
</span><span class="n">test4_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unnest</span><span class="p">(</span><span class="n">filter</span><span class="p">(</span><span class="n">man_sents</span><span class="p">,</span><span class="w"> </span><span class="n">manifesto_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"43120_201510"</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="p">)</span></code></pre></figure> <ul> <li>
<code class="highlighter-rouge">test2_df</code> has just one row, and the single cell of column “text” contains the entire, uncoded text of the manifesto. This is typical for very old manifestos or manifestos of very small parties, where the Manifesto Project team assigned no expert to split the manifesto in quasi-sentences and code it. We say that this manifesto has <em>not</em> been “annotated”.</li> <li>All other test cases have multiple rows. Each row corresponds to one coded quasi sentence. Codes are recorded in column “cmp_code”.</li> <li>However, in contrast to <code class="highlighter-rouge">test3_df</code>, <code class="highlighter-rouge">test2_df</code> and <code class="highlighter-rouge">test_df</code> have only numerical codes, that is, no “H” code indicating document headers and titles.</li> <li>But <code class="highlighter-rouge">test3_df</code> and <code class="highlighter-rouge">test4_df</code> have both titles, but in the former case which rows hold the manifesto title needs to be inferred from the ordering of text lines.</li> </ul> <p>This sounds confusing? It is. But no worries. Function <code class="highlighter-rouge">enhance_manifesto_df()</code> handles all these intricacies for you as shown below.</p> <h3 id="step-4-enhance-manifesto-data-frames">Step 4: Enhance manifesto data frames</h3> <p><code class="highlighter-rouge">enhance_manifesto_df()</code> returns a <code class="highlighter-rouge">manifesto.df</code> object that inherits from the input <code class="highlighter-rouge">tibble</code>, and simply adds four columns indicating document structure:</p> <ul> <li>“qs_nr” (running quasi-sentence counter),</li> <li>“sent_nr” (running sentence counter),</li> <li>“role” (indicator, here “qs” for all rows), and</li> <li>“bloc_nr” (enumerates consecutive rows by “role”).</li> </ul> <p>In addition, the returned <code class="highlighter-rouge">manifesto.df</code> obejct has two additional attributes:</p> <ul> <li>“annotated”: indicates wehtehr or not the input o has been annotated/coded by CMP experts.</li> <li>“extra_cols”: names of columns added by enhancing the ta frame.</li> </ul> <p>By enhancing manifesto data frames, we add bloc, sentence and quasi-sentence (qs) counters, as well as a role indicators (“qs”, “header”, “title”, or “meta”).</p> <p>As one natrual sentence may contain multiple quasi-sentences, the latter map m:1 to the former. A bloc, in turn, is a number of consecutive rolws that all have the same “role”. The following rows are defined:</p> <ul> <li>“qs”: A quasi-sentence</li> <li>“title”: The manifesto title. This is/are the first row(s) with CMP code “H” or <code class="highlighter-rouge">NA</code>.</li> <li>“header”: A chapter header. Rows after title (if any) with CMP code “H” or <code class="highlighter-rouge">NA</code>.</li> <li>“meta”: In annotated manifestos containing “H” codes (e.g. test case 4), the row(s) between “title” and the first “header” rows.</li> </ul> <p>This information is important if you want to count the number of chapters in a manifesto (= No. headers), or print only the title (if exists). And as noted above, having at hand this information, one could easily aggregate quasi-sentences at the sentence or chapter level while omitting title and other meta text.</p> <p>Let’s first enhance the data of test case 1 and inspect the results</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### enhance test case 1</span><span class="w">
</span><span class="n">test1_res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">enhance_manifesto_df</span><span class="p">(</span><span class="n">test1_df</span><span class="p">)</span><span class="w">
</span><span class="nf">class</span><span class="p">(</span><span class="n">test1_res</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "manifesto.df" "tbl_df"       "tbl"          "data.frame"</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="nf">attr</span><span class="p">(</span><span class="n">test1_res</span><span class="p">,</span><span class="w"> </span><span class="s2">"annotated"</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] TRUE</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="nf">attr</span><span class="p">(</span><span class="n">test1_res</span><span class="p">,</span><span class="w"> </span><span class="s2">"extra_cols"</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "role"    "qs_nr"   "sent_nr" "bloc_nr"</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="s2">"title"</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">test1_res</span><span class="o">$</span><span class="n">role</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] FALSE</code></pre></figure> <p>As you can see,</p> <ul> <li>the result is a “manifesto.df” object,</li> <li>it has both an “annotated” and an “extra_cols” attribute,</li> <li>the “annotated” indicates that input manifesto data is annotated, but</li> <li>no title line(s) could be detected from the input manifesto.</li> </ul> <p>As already discussed above, this stands in contrast to test case 3</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### enhance test case 3</span><span class="w">
</span><span class="n">test3_res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">enhance_manifesto_df</span><span class="p">(</span><span class="n">test3_df</span><span class="p">)</span><span class="w">
</span><span class="s2">"title"</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">test3_res</span><span class="o">$</span><span class="n">role</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] TRUE</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">print</span><span class="p">(</span><span class="n">test3_res</span><span class="o">$</span><span class="n">text</span><span class="p">[</span><span class="n">test3_res</span><span class="o">$</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"title"</span><span class="p">])</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "Für eine zukunftsfähige Schweiz" "Wahlplattform 1999"</code></pre></figure> <p>As the below table shows, we cannot detect title lines because the manifesto text starts with uncoded quasi-sentences. If you scroll through the excerpt of the resulting data frame (only columns one and 17-25, first six rows are shown), you can also see how quasi-sentences are nested in sentences, and how they are bound my header and/or title lines. Quasi-sentence 1 and 2, for example, are nested in the first sentence.</p> <table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"> <caption>Enhanced test case 1 (rows 1-6)</caption> <thead> <tr> <th style="text-align:left;"> manifesto_id </th> <th style="text-align:left;"> text </th> <th style="text-align:left;"> cmp_code </th> <th style="text-align:left;"> role </th> <th style="text-align:right;"> qs_nr </th> <th style="text-align:right;"> sent_nr </th> <th style="text-align:right;"> bloc_nr </th> </tr> </thead> <tbody> <tr> <td style="text-align:left;"> 43110_199910 </td> <td style="text-align:left;"> Für eine zukunftsfähige Schweiz </td> <td style="text-align:left;"> NA </td> <td style="text-align:left;"> title </td> <td style="text-align:right;"> NA </td> <td style="text-align:right;"> NA </td> <td style="text-align:right;"> 0 </td> </tr> <tr> <td style="text-align:left;"> 43110_199910 </td> <td style="text-align:left;"> Wahlplattform 1999 </td> <td style="text-align:left;"> NA </td> <td style="text-align:left;"> title </td> <td style="text-align:right;"> NA </td> <td style="text-align:right;"> NA </td> <td style="text-align:right;"> 0 </td> </tr> <tr> <td style="text-align:left;"> 43110_199910 </td> <td style="text-align:left;"> Die Grünen freuen sich, eine Wahlplattform für eine ökologische, soziale und weltoffene Schweiz </td> <td style="text-align:left;"> 501 </td> <td style="text-align:left;"> qs </td> <td style="text-align:right;"> 1 </td> <td style="text-align:right;"> 1 </td> <td style="text-align:right;"> 1 </td> </tr> <tr> <td style="text-align:left;"> 43110_199910 </td> <td style="text-align:left;"> - kurz eine zukunftsfähige Schweiz zu präsentieren. </td> <td style="text-align:left;"> 601 </td> <td style="text-align:left;"> qs </td> <td style="text-align:right;"> 2 </td> <td style="text-align:right;"> 1 </td> <td style="text-align:right;"> 1 </td> </tr> </tbody> </table> <p>The first header (chapter) occurs in text line 40.</p> <table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"> <caption>Enhanced test case 1 (rows 38-42)</caption> <thead> <tr> <th style="text-align:left;"> manifesto_id </th> <th style="text-align:left;"> text </th> <th style="text-align:left;"> cmp_code </th> <th style="text-align:left;"> role </th> <th style="text-align:right;"> qs_nr </th> <th style="text-align:right;"> sent_nr </th> <th style="text-align:right;"> bloc_nr </th> </tr> </thead> <tbody> <tr> <td style="text-align:left;"> 43110_199910 </td> <td style="text-align:left;"> Viele Reformen begannen mit einem grünen Vorstoss und endeten - oft Jahre danach - mit einem Sieg in der Volksabstimmung. </td> <td style="text-align:left;"> 305 </td> <td style="text-align:left;"> qs </td> <td style="text-align:right;"> 36 </td> <td style="text-align:right;"> 29 </td> <td style="text-align:right;"> 1 </td> </tr> <tr> <td style="text-align:left;"> 43110_199910 </td> <td style="text-align:left;"> Wirkliche Reformen gibt es nur mit uns. </td> <td style="text-align:left;"> 305 </td> <td style="text-align:left;"> qs </td> <td style="text-align:right;"> 37 </td> <td style="text-align:right;"> 30 </td> <td style="text-align:right;"> 1 </td> </tr> <tr> <td style="text-align:left;"> 43110_199910 </td> <td style="text-align:left;"> Mit dem Beitritt zur EU und zur UNO Verantwortung übernehmen und dort mitbestimmen, wo Entscheide gefällt werden </td> <td style="text-align:left;"> NA </td> <td style="text-align:left;"> header </td> <td style="text-align:right;"> NA </td> <td style="text-align:right;"> NA </td> <td style="text-align:right;"> 2 </td> </tr> <tr> <td style="text-align:left;"> 43110_199910 </td> <td style="text-align:left;"> Die Grünen stehen der europäischen Integration positiv gegenüber. </td> <td style="text-align:left;"> 108 </td> <td style="text-align:left;"> qs </td> <td style="text-align:right;"> 38 </td> <td style="text-align:right;"> 31 </td> <td style="text-align:right;"> 3 </td> </tr> <tr> <td style="text-align:left;"> 43110_199910 </td> <td style="text-align:left;"> Europäische Zusammenarbeit ist notwendig, da Ökologie und Soziales auch grenzüberschreitende Lösungen erfordern. </td> <td style="text-align:left;"> 108 </td> <td style="text-align:left;"> qs </td> <td style="text-align:right;"> 39 </td> <td style="text-align:right;"> 32 </td> <td style="text-align:right;"> 3 </td> </tr> </tbody> </table> <p>Now, we can also enhance the other test cases data.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### enhance test case 1</span><span class="w">
</span><span class="n">test2_res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">enhance_manifesto_df</span><span class="p">(</span><span class="n">test2_df</span><span class="p">)</span><span class="w">
</span><span class="c1">### enhance test case 4</span><span class="w">
</span><span class="n">test4_res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">enhance_manifesto_df</span><span class="p">(</span><span class="n">test4_df</span><span class="p">)</span></code></pre></figure> <h3 id="step-5-convert-manifesto-data-frames-to-xml-documents">Step 5: Convert manifesto data frames to XML documents</h3> <p>Having enhanced our test case data frames, we can now use <code class="highlighter-rouge">manifesto_df_to_xml()</code> to convert them to XML. You have basically two options</p> <ul> <li>setting <code class="highlighter-rouge">parse = FALSE</code> returns the XML-formatted string</li> <li>setting <code class="highlighter-rouge">parse = TRUE</code> (the default) returns an {xml2} <code class="highlighter-rouge">xml_document</code> object.</li> </ul> <p>We convert parse the data of the first text into and XML formatted string.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### test case 1: as string</span><span class="w">
</span><span class="n">test1_xml</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">manifesto_df_to_xml</span><span class="p">(</span><span class="n">test1_res</span><span class="p">,</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="nf">class</span><span class="p">(</span><span class="n">test1_xml</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "character"</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="nf">length</span><span class="p">(</span><span class="n">test1_xml</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] 1</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">test1_xml</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">manifesto_df_to_xml</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">test1_res</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="n">test1_xml</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## &lt;manifesto&gt;
##   &lt;head
##      manifesto-id="43120_201110"
##      party="43120"
##      date="201110"
##      language="german"
##      source="MARPOR"
##      has-eu-code="FALSE"
##      is-primary-doc="TRUE"
##      may-contradict-core-dataset="FALSE"
##      md5sum-text="477db1a44a9c3531ce50e09522bb8daa"
##      annotations="TRUE"
##      handbook="4"
##      id="43120_201110"
##      partyname="Green Liberal Party"
##      partyabbrev="GLP"
##   &gt;
##     &lt;title&gt;
##       &lt;p&gt;Eidgenössische Volksinitiative&lt;/p&gt;
##     &lt;/title&gt;
##   &lt;/head&gt;
##   &lt;body&gt;
##     &lt;chapter nr="1"&gt;
##       &lt;sentence nr="1"&gt;
##         &lt;quasi-sentence nr="1" cmp-code="501"&gt;Mit der Einführung einer Energiesteuer auf nicht erneuerbarer Energie werden Energieeffizienz, Energiesparen und erneuerbare Energien ökonomisch interessant.&lt;/quasi-sentence&gt;
##       &lt;/sentence&gt;
##       &lt;sentence nr="2"&gt;
##         &lt;quasi-sentence nr="2" cmp-code="303"&gt;Die Abschaffung der komplizierten Mehrwertsteuer befreit Wertschöpfung von Steuern.&lt;/quasi-sentence&gt;
##       &lt;/sentence&gt;
##       &lt;sentence nr="3"&gt;
##         &lt;quasi-sentence nr="3" cmp-code="411"&gt;Insgesamt stärkt die Initiative die Innovation, reduziert die Administration bei Unternehmen und Staat.&lt;/quasi-sentence&gt;
##       &lt;/sentence&gt;
##       &lt;sentence nr="4"&gt;
##         &lt;quasi-sentence nr="4" cmp-code="501"&gt;Der Verbrauch von öl, Gas und Atomstrom wird sinken, der CO2-Ausstoss reduziert: Auch bleiben Milliarden für Wertschöpfung im Inland statt ins Ausland abzufliessen.&lt;/quasi-sentence&gt;
##       &lt;/sentence&gt;
##       &lt;sentence nr="5"&gt;
##         &lt;quasi-sentence nr="5" cmp-code="000"&gt;Die fixe Verknüpfung des Ertrages an das Bruttoinlandprodukt sichert eine staatsquotenneutrale Umsetzung.&lt;/quasi-sentence&gt;
##       &lt;/sentence&gt;
##     &lt;/chapter&gt;
##     &lt;chapter nr="2"&gt;
##       &lt;header&gt;
##         &lt;p&gt;Energie&lt;/p&gt;
##       &lt;/header&gt;
##     &lt;/chapter&gt;
##   &lt;/body&gt;
## &lt;/manifesto&gt;</code></pre></figure> <p>Note that while the title of the manifesto was not contained in the text data, it was contained in the manifesto meta data (column “title”).</p> <p>When we use the default setting <code class="highlighter-rouge">parse = TRUE</code>, the resulting object is a <code class="highlighter-rouge">xml2</code> <code class="highlighter-rouge">xml_document</code> instance.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### test case 1: as XML document</span><span class="w">
</span><span class="n">test1_xml</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">manifesto_df_to_xml</span><span class="p">(</span><span class="n">test1_res</span><span class="p">)</span><span class="w">
</span><span class="nf">class</span><span class="p">(</span><span class="n">test1_xml</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "xml_document" "xml_node"</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">test1_xml</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## {xml_document}
## &lt;manifesto&gt;
## [1] &lt;head manifesto-id="43120_201110" party="43120" date="201110" language="g ...
## [2] &lt;body&gt;\n  &lt;chapter nr="1"&gt;\n    &lt;sentence nr="1"&gt;\n      &lt;quasi-sentence  ...</code></pre></figure> <p>The results looks similar for test case 3, but now the “head” node also includes a “title” node.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### test case 3</span><span class="w">
</span><span class="n">test3_xml</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">manifesto_df_to_xml</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">test3_res</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="n">test3_xml</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## &lt;manifesto&gt;
##   &lt;head
##      manifesto-id="43110_199910"
##      party="43110"
##      date="199910"
##      language="german"
##      source="MARPOR"
##      has-eu-code="FALSE"
##      is-primary-doc="TRUE"
##      may-contradict-core-dataset="FALSE"
##      md5sum-text="4db941bd08b626f99f75317b70235a4c"
##      url-original="/down/originals/43110_1999.pdf"
##      md5sum-original="CURRENTLY_UNAVAILABLE"
##      annotations="TRUE"
##      handbook="1"
##      title="Für eine zukunftsfähige Schweiz"
##      id="43110_199910"
##      partyname="Green Party of Switzerland"
##      partyabbrev="GPS/PES"
##   &gt;
##     &lt;title&gt;
##       &lt;p&gt;Für eine zukunftsfähige Schweiz&lt;/p&gt;
##       &lt;p&gt;Wahlplattform 1999&lt;/p&gt;
##     &lt;/title&gt;
##   &lt;/head&gt;
##   &lt;body&gt;
##     &lt;chapter nr="0"&gt;
##       &lt;sentence nr="1"&gt;
##         &lt;quasi-sentence nr="1" cmp-code="501"&gt;Die Grünen freuen sich, eine Wahlplattform für eine ökologische, soziale und weltoffene Schweiz&lt;/quasi-sentence&gt;
##         &lt;quasi-sentence nr="2" cmp-code="601"&gt;- kurz eine zukunftsfähige Schweiz zu präsentieren.&lt;/quasi-sentence&gt;
##       &lt;/sentence&gt;
##       &lt;sentence nr="2"&gt;
##         &lt;quasi-sentence nr="3" cmp-code="201"&gt;In Verantwortung gegenüber künftigen Generationen setzen wir uns ein für die Erhaltung der Lebensgrundlagen, für die Menschenrechte&lt;/quasi-sentence&gt;
##         &lt;quasi-sentence nr="4" cmp-code="503"&gt;und für die Verminderung der Unterschiede zwischen arm und reich.&lt;/quasi-sentence&gt;
##       &lt;/sentence&gt;
##     &lt;/chapter&gt;
##   &lt;/body&gt;
## &lt;/manifesto&gt;</code></pre></figure> <p>As shown in the next code block, you can access the different nodes and attributes of the returned XML documents using <code class="highlighter-rouge">rvest</code>’s <code class="highlighter-rouge">html_*</code>.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">test3_xml</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">manifesto_df_to_xml</span><span class="p">(</span><span class="n">test3_res</span><span class="p">)</span><span class="w">
</span><span class="nf">class</span><span class="p">(</span><span class="n">test3_xml</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "xml_document" "xml_node"</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">test3_xml</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## {xml_document}
## &lt;manifesto&gt;
## [1] &lt;head manifesto-id="43110_199910" party="43110" date="199910" language="g ...
## [2] &lt;body&gt;\n  &lt;chapter nr="1"&gt;\n    &lt;sentence nr="1"&gt;\n      &lt;quasi-sentence  ...</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">html_node</span><span class="p">(</span><span class="n">test3_xml</span><span class="p">,</span><span class="w"> </span><span class="s2">"title"</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## {xml_node}
## &lt;title&gt;
## [1] &lt;p&gt;Für eine zukunftsfähige Schweiz&lt;/p&gt;
## [2] &lt;p&gt;Wahlplattform 1999&lt;/p&gt;</code></pre></figure> <h3 id="step-6-optional-apply-to-all-manifestos-in-one-pipeline">Step 6 (optional): Apply to all manifestos in one pipeline</h3> <p>The below code simply combines the above steps in a single pipeline.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">man_xmls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">man_sents</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="c1">### drop unneccessary columns (optional)</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="w">
    </span><span class="o">-</span><span class="n">has_eu_code</span><span class="w">
    </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">may_contradict_core_dataset</span><span class="w">
    </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">md5sum_text</span><span class="w">
    </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">md5sum_original</span><span class="w">
    </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">annotations</span><span class="w">
    </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">id</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="c1">### unnest data</span><span class="w">
  </span><span class="n">unnest</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="c1">### split by manifesto ID (-&gt; list od DFs)</span><span class="w">
  </span><span class="n">split</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">manifesto_id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="c1">### apply enhance</span><span class="w">
  </span><span class="n">map</span><span class="p">(</span><span class="n">enhance_manifesto_df</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="c1">### apply converter</span><span class="w">
  </span><span class="n">map</span><span class="p">(</span><span class="n">safely</span><span class="p">(</span><span class="n">manifesto_df_to_xml</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="c1">### gather all in list-column data frame </span><span class="w">
  </span><span class="n">enframe</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">transmute</span><span class="p">(</span><span class="w">
    </span><span class="n">manifesto_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="w">
    </span><span class="p">,</span><span class="w"> </span><span class="n">xml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="s2">"result"</span><span class="p">)</span><span class="w">
    </span><span class="p">,</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="n">map</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="s2">"error"</span><span class="p">),</span><span class="w"> </span><span class="s2">"message"</span><span class="p">)</span><span class="w">
    </span><span class="p">,</span><span class="w"> </span><span class="n">n_errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lengths</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span></code></pre></figure> <p>Calling this code returns a tibble with list-column “xml” containing the individual manifesto XML documents.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### the returned tibble contains xml_documents in the "xml" list-column</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">man_xmls</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 3 x 4
##   manifesto_id xml        errors n_errors
##   &lt;chr&gt;        &lt;list&gt;     &lt;list&gt;    &lt;int&gt;
## 1 43110_198710 &lt;xml_dcmn&gt; &lt;NULL&gt;        0
## 2 43110_199110 &lt;xml_dcmn&gt; &lt;NULL&gt;        0
## 3 43110_199510 &lt;xml_dcmn&gt; &lt;NULL&gt;        0</code></pre></figure> <p>To make sure that all covnersions were successful, you can look at column “n_errors”:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### there were no errors raised</span><span class="w">
</span><span class="n">man_xmls</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">n_errors</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">unnest</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 0 x 4
## # … with 4 variables: manifesto_id &lt;chr&gt;, xml &lt;list&gt;, errors &lt;???&gt;,
## #   n_errors &lt;int&gt;</code></pre></figure> <h3 id="step-7-optional-write-manifestos-to-disk">Step 7 (optional): write manifestos to disk</h3> <p>You can alos loop over XML documents and write them to disk.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### write to disk</span><span class="w">
</span><span class="n">map2</span><span class="p">(</span><span class="w">
  </span><span class="n">man_xmls</span><span class="o">$</span><span class="n">xml</span><span class="w">
  </span><span class="p">,</span><span class="w"> </span><span class="n">man_xmls</span><span class="o">$</span><span class="n">manifesto_id</span><span class="w">
  </span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="s2">"your"</span><span class="p">,</span><span class="w"> </span><span class="s2">"local"</span><span class="p">,</span><span class="w"> </span><span class="s2">"path"</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">write_xml</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="s2">".xml"</span><span class="p">)))</span><span class="w">  
</span><span class="p">})</span></code></pre></figure> <h2 id="summing-up">Summing up</h2> <p>To reconstruct manifesto document structure from <code class="highlighter-rouge">manifestoR</code> obejcts, you can use functions provided by the <code class="highlighter-rouge">manifestoEnhanceR</code> package.</p> <p>The basic data processing pipeline involves:</p> <ol> <li>querying manifestos from the Manifesto Project API,</li> <li>covnerting the <code class="highlighter-rouge">manifestoR</code> package’s custom data objects into a tidy data format (i.e., a data frame),</li> <li>enhancing manifesto data frames with text-level information (e.g., quasi-sentence and chapter numbers), and</li> <li>converting the enhanced manifesto data frames to XML documents.</li> </ol> <p>The <code class="highlighter-rouge">manifestoEnhanceR</code> package is currently only available via GitHub: https://github.com/haukelicht/manifestoEnhanceR</p> <p>Feel free to retweet this post on Twitter and comment on it!</p> <h2 id="footnotes">(Footnotes)</h2> <div class="footnotes"> <ol> <li id="fn:1"> <p>For these latter puproses, quasi-sentences are not an ideal unit of (dis)aggregation. Sentences, paragraphs or chapters seem more appropriate. <a href="#fnref:1" class="reversefootnote">↩</a></p> </li> <li id="fn:2"> <p>The dot separating the “as_tibble” and “ManifestoCorpus” indicates that this is the “as_tibble” method for “ManifestoCorpus” instances/object. You can read more about methods in the <a href="https://stat.ethz.ch/R-manual/R-patched/library/methods/html/Methods_Details.html" title="R Documentation: General Information on Methods">R Documentation</a> and the amazing <a href="http://adv-r.had.co.nz/S3.html" title="Advanced R: The S3 object system"><em>Advanced R</em></a> <a href="#fnref:2" class="reversefootnote">↩</a></p> </li> </ol> </div> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="http://localhost:4000/tags/#data%20wrangling" title="Pages tagged data wrangling" class="tag"><span class="term">data wrangling</span></a><a href="http://localhost:4000/tags/#manifesto%20data" title="Pages tagged manifesto data" class="tag"><span class="term">manifesto data</span></a><a href="http://localhost:4000/tags/#Manifestos%20Project" title="Pages tagged Manifestos Project" class="tag"><span class="term">Manifestos Project</span></a><a href="http://localhost:4000/tags/#R" title="Pages tagged R" class="tag"><span class="term">R</span></a><a href="http://localhost:4000/tags/#manifestoR" title="Pages tagged manifestoR" class="tag"><span class="term">manifestoR</span></a><a href="http://localhost:4000/tags/#manifestoEnhanceR" title="Pages tagged manifestoEnhanceR" class="tag"><span class="term">manifestoEnhanceR</span></a><a href="http://localhost:4000/tags/#XML" title="Pages tagged XML" class="tag"><span class="term">XML</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/manifestoR-data-structure-to-XML-tutorial/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/manifestoR-data-structure-to-XML-tutorial/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <!-- <a href="https://plus.google.com/share?url=http://localhost:4000/manifestoR-data-structure-to-XML-tutorial/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> --> </span> <div style="clear:both"></div> </div> </div> </div> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <!-- MathJax --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } }); </script> <script type="text/javascript" charset="utf-8" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script> <script type="text/javascript" charset="utf-8" src="https://vincenttam.github.io/javascripts/MathJaxLocal.js"> </script> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>

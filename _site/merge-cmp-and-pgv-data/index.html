<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>Merging Comparative Manifesto Project and ParlGov cabinet composition data at the party-level &#8211; Hauke Licht</title> <meta name="description" content="Hi! I'm a Ph.D. student of Political Science at the University of Zurich."> <meta name="keywords" content="data wrangling, tidyverse, parties, policy positions, party data, manifestos, CMP, Parlgov, merging, joining, merge, join, missing data"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/hauke_licht_front_color_narrow_small.jpg"> <meta name="twitter:title" content="Merging Comparative Manifesto Project and ParlGov cabinet composition data at the party-level"> <meta name="twitter:description" content="In this post, I use data from the Comparative Manifesto Project and ParlGov to find out whether the manifesto used in a given election was published by a party that was in government at this point in time."> <meta name="twitter:site" content="@hauke_licht"> <meta name="twitter:creator" content="@hauke_licht"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Merging Comparative Manifesto Project and ParlGov cabinet composition data at the party-level"> <meta property="og:description" content="In this post, I use data from the Comparative Manifesto Project and ParlGov to find out whether the manifesto used in a given election was published by a party that was in government at this point in time."> <meta property="og:url" content="http://localhost:4000/merge-cmp-and-pgv-data/"> <meta property="og:site_name" content="Hauke Licht"> <meta property="og:image" content="http://localhost:4000/assets/img/hauke_licht_front_color_narrow_small.jpg"> <link rel="canonical" href="http://localhost:4000/merge-cmp-and-pgv-data/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Hauke Licht Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/hauke_licht.png" /> <!-- <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> --> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/bg_dark.jpg); }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/hauke_licht_front_color_narrow_small.jpg" alt="Hauke Licht photo" class="author-photo"> <h4>Hauke Licht</h4> <p>Hi! I'm a Ph.D. student of Political Science at the University of Zurich.</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:hauke.licht@uzh.ch" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://twitter.com/hauke_licht" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://github.com/haukelicht" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> <li> <a href="https://www.ipz.uzh.ch/en/institut/mitarbeitende/staff/licht.html" target="_blank" rel="noopener noreferrer"><i class="fa fa-university"></i> Work</a> </li> <li> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="http://localhost:4000/research/">Research</a> </li> <li> <a href="http://localhost:4000/cv/">CV</a> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">All Posts</a></li> <li><a href="http://localhost:4000/tags/">All Tags</a></li> </ul> </li> <li> <a href="http://localhost:4000/credit/">Credits</a> </li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Merging Comparative Manifesto Project and ParlGov cabinet composition data at the party-level</h1> <h4>07 Mar 2019</h4> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <h2 id="goal-of-this-post">Goal of this Post</h2> <p>The data provided by the <a href="https://manifesto-project.wzb.eu/">Comparative Manifesto Project</a> (CMP) is a rich and valuable source of information for researchers interested in parties policy positions and salience strategies. The CMP main dataset records policy issue positions at the level of parties nested within countries and elections. Specifically, issue positions and salience measurements are derived from parties‚Äô election manifestos.<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> These manifestos are usually produced as parts of parties campaigning efforts and regularly issued six to one month prior to upcoming elections.</p> <p>In this post, we will focus on a particular piece of information that is lacking in the CMP data: an indicator of parties‚Äô government status that would allow to distinguish government from opposition parties. Specifically, our goal is to <strong>find out whether the manifesto used in a given election was published by a party that was in government at this point in time</strong>.</p> <p>In order to accomplish this goal, I will add to the CMP data information contained in <a href="www.parlgov.org">ParlGov</a>‚Äôs (PGV) <a href="http://www.parlgov.org/data/table/view_cabinet/">cabinet view</a>. In the PGV cabinet view, elections map m:1 to countries, elections map 1:m to cabinets, and parties are nested in election-cabinet configurations. It is a notable feature of this dataset that it keeps track of the different cabinets formed based on the results of a given election as well as of their timing (i.e., cabinet start dates).</p> <h2 id="similar-but-different-relating-cmp-and-pgv-data">Similar but different: Relating CMP and PGV data</h2> <h3 id="two-data-logics">Two data logics</h3> <p>Adding PGV indicators to the CMP data sounds simpler than it actually is (see also <a href="https://manifesto-project.wzb.eu/tutorials/parlgov_merge">here</a> and <a href="http://dimiter.eu/Data_files/gov_positions/government_positions_from_party_data.html">here</a>). In the CMP data, manifesto-related indicators (e.g., issue position) map 1:1 to country-election-party configurations. But the election date recorded is that of the post-campaign election. That is, for a manifesto published at day $X$, the election on day $Y$ is the <em>upcoming</em> election in the sense that $X &lt; Y$.</p> <p>This stands in contrast to the PGV data, where the recorded election is only the point of reference during cabinet formation, so that if a cabinet forms on day $Z$ based on the results of election of day $Y$, we always have $Y &lt; Z$. As a consequence, a first complication when wanting to determine CMP parties‚Äô government status is that <em>we cannot simply join PGV cabinet data to CMP election data at the party-level using election dates</em>, but first need to identify the cabinet that was running (i.e., in office) when the election was held at which the CMP manifesto-related datasets are pointing.</p> <h3 id="different-ids-and-incomplete-lookuplink-tables">Different IDs and incomplete lookup/link tables</h3> <p>The second complication is that parties are not only differently named and abbreviated in PGV than in CMP data, but that dataset-specific IDs are generally non-matching. What is more, to my knowledge there exists no complete look-up table that would allow to match parties between datasets.</p> <h2 id="hands-on">Hands-on</h2> <p>But it would probably not have been so much fun to write this post, if I hadn‚Äôt had found ways to solve these problems üëç So let‚Äôs get started!</p> <h3 id="first-things-first">First things first</h3> <p>First, some basic setup: I load all required packages and define some helper functions (and add <code class="highlighter-rouge">roxygen2</code> docu, just in case):</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># setup ----</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">manifestoR</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">


</span><span class="cd">#' If NA, then ...</span><span class="w">
</span><span class="cd">#'</span><span class="w">
</span><span class="cd">#' @description Given a scalar value `x`, function replaces it with a specified value if the input is NA</span><span class="w">
</span><span class="cd">#'</span><span class="w">
</span><span class="cd">#' @param x a scalar value to be evaluated in \code{is.na(x)}</span><span class="w">
</span><span class="cd">#'</span><span class="w">
</span><span class="cd">#' @param then the value to replace \code{x} with if \code{is.na(x)} evaluates to true \code{TRUE}</span><span class="w">
</span><span class="cd">#'</span><span class="w">
</span><span class="cd">#' @return if \code{is.na(x)}, then \code{then}, else \code{x}</span><span class="w">
</span><span class="n">if_na</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">then</span><span class="p">)</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="w"> </span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">then</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">)</span><span class="w">


</span><span class="cd">#' Is distinct?</span><span class="w">
</span><span class="cd">#'</span><span class="w">
</span><span class="cd">#' @description Given a dataframe, matrix, list or vector object, function test if the number of unique rows or elements </span><span class="w">
</span><span class="cd">#'     equals the total number of rows or elements, respectively.</span><span class="w">
</span><span class="cd">#'</span><span class="w">
</span><span class="cd">#' @param x dataframe, matrix, list or vector object</span><span class="w">
</span><span class="cd">#'</span><span class="w">
</span><span class="cd">#' @return logical</span><span class="w">
</span><span class="n">is_unique</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">inherits</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s2">"data.frame"</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">is.matrix</span><span class="p">(</span><span class="n">x</span><span class="p">)){</span><span class="w">
        </span><span class="n">nrow</span><span class="p">(</span><span class="n">pgv_elcs</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">pgv_elcs</span><span class="p">))</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is.vector</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">is.list</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nf">length</span><span class="p">(</span><span class="n">pgv_elcs</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">pgv_elcs</span><span class="p">))</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">stop</span><span class="p">(</span><span class="s2">"`x` must be a data.frame, list or vector object"</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure> <p>Next we‚Äôll define a dataframe containing information on the countries we are interested in:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">countries</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="w">
</span><span class="s1">'"country_name","country_iso2c","country_iso3c"
"Austria","AT","AUT"
"Belgium","BE","BEL"
"Denmark","DK","DNK"
"Finland","FI","FIN"
"France","FR","FRA"
"Germany","DE","DEU"
"Greece","GR","GRC"
"Ireland","IE","IRL"
"Italy","IT","ITA"
"Iceland","IS","ISL"
"Luxembourg","LU","LUX"
"Netherlands","NL","NLD"
"Norway","NO","NOR"
"Portugal","PT","PRT"
"Spain","ES","ESP"
"Sweden","SE","SWE"
"Switzerland","CH","CHE"
"United Kingdom","GB","GBR"'</span><span class="w">
</span><span class="p">)</span></code></pre></figure> <h3 id="get-cmp-data">Get CMP data</h3> <p>Now we can download the CMP dataset using the manifesto-project‚Äôs API. Note that you first have to <a href="https://manifesto-project.wzb.eu/signup">register</a> with manifesto-project.org and save the API key,<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup> and then load the API key using <code class="highlighter-rouge">mp_setapikey</code>:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">mp_setapikey</span><span class="p">(</span><span class="s2">"your/path/to/secret/manifesto_apikey.txt"</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># get available version</span><span class="w">
</span><span class="n">cmp_versions</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mp_coreversions</span><span class="p">()</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## Connecting to Manifesto Project DB API...</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># get newest version</span><span class="w">
</span><span class="p">(</span><span class="n">this_version</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cmp_versions</span><span class="o">$</span><span class="n">datasets.id</span><span class="p">[</span><span class="n">nrow</span><span class="p">(</span><span class="n">cmp_versions</span><span class="p">)])</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "MPDS2018b"</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># get data</span><span class="w">
</span><span class="n">cmp_raw</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mp_maindataset</span><span class="p">(</span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_version</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## Connecting to Manifesto Project DB API... corpus version: 2018-2</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># do all match countries?</span><span class="w">
</span><span class="n">cmp_countries</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">cmp_raw</span><span class="o">$</span><span class="n">countryname</span><span class="p">)</span><span class="w">

</span><span class="nf">all</span><span class="p">(</span><span class="n">cmp_countries</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">countries</span><span class="o">$</span><span class="n">country_name</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] FALSE</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="nf">all</span><span class="p">(</span><span class="n">countries</span><span class="o">$</span><span class="n">country_name</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">cmp_countries</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] TRUE</code></pre></figure> <p>Checking our list of select countries against the countries contained in the CMP, we can verify that none of the countries we are interested in is missing in the CMP data. Hence, I create the dataframe <code class="highlighter-rouge">cmp</code> that keeps only rows of select countries and only elections since the 1980s.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">cmp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cmp_raw</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># keep only select countries</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">countryname</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">countries</span><span class="o">$</span><span class="n">country_name</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">edate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ymd</span><span class="p">(</span><span class="n">edate</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># keep only elections since the 80s</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">edate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">ymd</span><span class="p">(</span><span class="s2">"1979-12-31"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">left_join</span><span class="p">(</span><span class="n">countries</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"countryname"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"country_name"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">mutate_if</span><span class="p">(</span><span class="n">is.character</span><span class="p">,</span><span class="w"> </span><span class="n">trimws</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">head</span><span class="p">(</span><span class="n">cmp</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">select</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">7</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 6 x 7
##   country countryname oecdmember eumember edate        date party
##     &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt; &lt;date&gt;      &lt;dbl&gt; &lt;dbl&gt;
## 1      11 Sweden              10        0 1982-09-19 198209 11220
## 2      11 Sweden              10        0 1982-09-19 198209 11320
## 3      11 Sweden              10        0 1982-09-19 198209 11420
## 4      11 Sweden              10        0 1982-09-19 198209 11620
## 5      11 Sweden              10        0 1982-09-19 198209 11810
## 6      11 Sweden              10        0 1985-09-15 198509 11220</code></pre></figure> <p>Here, we can nicely inspect the structure of the CMP dataset: Countries map 1:m elections, and elections 1:m to parties.</p> <h3 id="create-unique-cmp-country-election-party-combinations">Create unique CMP country-election-party combinations</h3> <p>Now we can get all distinct combinations of countries, elections and parties in the CMP data (dataframe <code class="highlighter-rouge">cmp_elc_ptys</code>), and validate that no invalid entries are in the resulting dataset.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">cmp_elc_ptys</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cmp</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">select</span><span class="p">(</span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">edate</span><span class="p">,</span><span class="w"> </span><span class="n">party</span><span class="p">,</span><span class="w"> </span><span class="n">partyname</span><span class="p">,</span><span class="w"> </span><span class="n">partyabbrev</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">rename_at</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"cmp_"</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">unique</span><span class="p">()</span><span class="w">

</span><span class="c1"># any party more than one abbreviation?</span><span class="w">
</span><span class="n">cmp_elc_ptys</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_edate</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_party</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">n_abrvs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_distinct</span><span class="p">(</span><span class="n">cmp_partyabbrev</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">n_abrvs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 0 x 4
## # Groups:   country_iso3c, cmp_edate [0]
## # ‚Ä¶ with 4 variables: country_iso3c &lt;chr&gt;, cmp_edate &lt;date&gt;,
## #   cmp_party &lt;dbl&gt;, n_abrvs &lt;int&gt;</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># any party more than one ID?</span><span class="w">
</span><span class="n">cmp_elc_ptys</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_edate</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_partyname</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">n_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_distinct</span><span class="p">(</span><span class="n">cmp_party</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">n_ids</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 0 x 4
## # Groups:   country_iso3c, cmp_edate [0]
## # ‚Ä¶ with 4 variables: country_iso3c &lt;chr&gt;, cmp_edate &lt;date&gt;,
## #   cmp_partyname &lt;chr&gt;, n_ids &lt;int&gt;</code></pre></figure> <h3 id="get-pgv-data">Get PGV data</h3> <p>Next we download the most actual cabinets and parties views from the PGV website, and validate that all countries of interest are contained it.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">cabs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"http://www.parlgov.org/static/data/development-cp1252/view_cabinet.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">locale</span><span class="p">(</span><span class="n">encoding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ISO-8859-1'</span><span class="p">))</span><span class="w">
</span><span class="n">ptys</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"http://www.parlgov.org/static/data/development-cp1252/view_party.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">locale</span><span class="p">(</span><span class="n">encoding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ISO-8859-1'</span><span class="p">))</span><span class="w">

</span><span class="n">pgv_ctrs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">cabs</span><span class="o">$</span><span class="n">country_name_short</span><span class="p">)</span><span class="w">

</span><span class="c1"># ensure compatibility: all PGV in CMP?</span><span class="w">
</span><span class="nf">all</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">cmp</span><span class="o">$</span><span class="n">country_iso3c</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">pgv_ctrs</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] TRUE</code></pre></figure> <h3 id="identify-running-cabinets-in-pgv-data">Identify ‚Äòrunning‚Äô cabinets in PGV data</h3> <p>The next step is crucial! As explained above, we are interested in running cabinet parties at the day of an election. Hence, we need to leverage both election data and cabinet start date information to identify just these. This is accomplished by the following very long, but extensively commented expression:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># for PGV country-election-cabinets, ...</span><span class="w">
</span><span class="n">pgv_elcs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cabs</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="c1"># keep select countries</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">country_name_short</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">cmp</span><span class="o">$</span><span class="n">country_iso3c</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="c1"># go back further to also retain previous cabs</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">ymd</span><span class="p">(</span><span class="n">election_date</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">ymd</span><span class="p">(</span><span class="s2">"1969-12-31"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="c1"># get distinct country-election configurations</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">country_name_short</span><span class="p">,</span><span class="w"> </span><span class="n">election_date</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">unique</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># get date of next election</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country_name_short</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">next_election_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lead</span><span class="p">(</span><span class="n">election_date</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># add cabinet info</span><span class="w">
    </span><span class="n">left_join</span><span class="p">(</span><span class="n">cabs</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"country_name_short"</span><span class="p">,</span><span class="w"> </span><span class="s2">"election_date"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># keep select columns</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="w">
        </span><span class="n">country_name_short</span><span class="p">,</span><span class="w"> 
        </span><span class="n">election_date</span><span class="p">,</span><span class="w"> </span><span class="n">next_election_date</span><span class="p">,</span><span class="w">
        </span><span class="n">cabinet_id</span><span class="p">,</span><span class="w"> </span><span class="n">cabinet_name</span><span class="p">,</span><span class="w"> </span><span class="n">start_date</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">unique</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># keep only cabinet last formed from a given election </span><span class="w">
    </span><span class="c1"># (NOTE: this is the cabinet ruinning when the next election was held)</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country_name_short</span><span class="p">,</span><span class="w"> </span><span class="n">election_date</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">start_date</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">start_date</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># (NOTE: the previous step makes rows uniquely identified election dates </span><span class="w">
    </span><span class="c1">#  within countries, since only one cabinet per country-election is retained)</span><span class="w">
    </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># again apply date filter</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">next_election_date</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">ymd</span><span class="p">(</span><span class="s2">"1974-12-31"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># rename</span><span class="w">
    </span><span class="n">rename</span><span class="p">(</span><span class="w">
        </span><span class="n">country_iso3c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country_name_short</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">cabinet_start_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start_date</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">rename_at</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"pgv_"</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="p">))</span></code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Nr. rows = Nr. distinct rows?</span><span class="w">
</span><span class="n">is_unique</span><span class="p">(</span><span class="n">pgv_elcs</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] TRUE</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">head</span><span class="p">(</span><span class="n">pgv_elcs</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 6 x 6
##   country_iso3c pgv_election_da‚Ä¶ pgv_next_electi‚Ä¶ pgv_cabinet_id
##   &lt;chr&gt;         &lt;date&gt;           &lt;date&gt;                    &lt;int&gt;
## 1 AUT           1971-10-10       1975-10-05                  365
## 2 AUT           1975-10-05       1979-05-06                  350
## 3 AUT           1979-05-06       1983-04-24                  463
## 4 AUT           1983-04-24       1986-11-23                  828
## 5 AUT           1986-11-23       1990-10-07                  873
## 6 AUT           1990-10-07       1994-10-09                  524
## # ‚Ä¶ with 2 more variables: pgv_cabinet_name &lt;chr&gt;,
## #   pgv_cabinet_start_date &lt;date&gt;</code></pre></figure> <p>The logic in <code class="highlighter-rouge">pgv_elcs</code> is the following:</p> <ul> <li>Each row is a unique country-election configuration.</li> <li>Column <code class="highlighter-rouge">election_date</code> records the actual date of the election, while column <code class="highlighter-rouge">next_election_date</code> records the date of the upcoming election.</li> <li>When we compare <code class="highlighter-rouge">start_date</code> (the selected cabinet‚Äôs start date) and <code class="highlighter-rouge">next_election_date</code>, we can confirm that the upcoming election falls into the period of activity of the cabinet we selected.</li> <li>Parties in the ‚ÄòKreisky IV‚Äô cabinet (Austria), which was formed from the parliament elected on 1979-05-06 and took office on 1979-06-05, for instance, are those parties that were in office when the next election was held (on 1983-04-24).</li> <li>This ‚Äònext‚Äô election, in turn, is the one used in the CMP data to index policy positions of those parties who managed to enter a parliament in the given election.</li> <li>Note, however, that these parties have likely issued their manifestos <em>before</em> they were elected into office.</li> <li>Hence, if we want to know whether a manifesto was written by a party that was holding government office, we need to look at the cabinet that was <em>running</em> (i.e., in office) when the election was held (in the above example, parties in the ‚ÄòKreisky IV‚Äô cabinet, not in the ‚ÄòVranitzky I‚Äô, which took office on 1986-06-16 and was only formed based on the results of the 1983-04-24 election). <!-- - since manifestos are virtually always issued before an election, and in the CMP the party data recorded for a given country-election configuration is based on the manifestos issued prior to this election, we want to match to a CMP country-election configurations the status of running cabinets (e.g., parties in the Kreisky IV cabinet), not of thos cabinets that were only formed from the given election (e.g., the Vranitzky I, taking office on 1986-06-16, only about two month _after_ the 1983-04-24 election) -->
</li> </ul> <h3 id="create-a-link-table-matching-cmp-to-pgv-election-dates">Create a link table matching CMP to PGV election dates</h3> <p>Once I have leveraged the PGV data to identify running cabinets for elections, I want to allow us to add this information to the CMP data. For this purpose I create a new link table mapping CMP to PGV elections. This step, too, requires some great care, since we cannot simply assume that election dates always match exactly.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># join country-elections on (inexact) election dates</span><span class="w">
</span><span class="n">ctr_elcs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pgv_elcs</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># NOTE: take next election due to differing data logics in CMP and PGV (see explanation above)</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">pgv_next_election_date</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">unique</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># get cross-product of elections within countries </span><span class="w">
    </span><span class="n">full_join</span><span class="p">(</span><span class="w">
        </span><span class="c1"># join CMP data</span><span class="w">
        </span><span class="n">cmp_elc_ptys</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
            </span><span class="n">select</span><span class="p">(</span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_edate</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
            </span><span class="n">unique</span><span class="p">()</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"country_iso3c"</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># compute date difference in days for each CMP-PGV election data pairing </span><span class="w">
    </span><span class="c1"># THIS POINT IS KEY!: take next election in PGV data due to differing data logics in CMP and PGV</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">abs_elc_date_diff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="n">pgv_next_election_date</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cmp_edate</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="c1"># at the country CMP-election level (reference data), keep the PGV (next) </span><span class="w">
    </span><span class="c1">#   election with the lowest data difference (0 days all but a few instance)</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_edate</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">top_n</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">wt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">desc</span><span class="p">(</span><span class="n">abs_elc_date_diff</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">ungroup</span><span class="p">()</span></code></pre></figure> <p>As commented in the code, it is crucial to match CMP election dates to the ‚Äònext‚Äô/‚Äôupcoming‚Äô election in the PGV data, since this is the one mapping to the cabinet that contains running cabinet parties.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># is distinct?</span><span class="w">
</span><span class="n">is_unique</span><span class="p">(</span><span class="n">pgv_elcs</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] TRUE</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># ensure that no CMP election maps to multiple PGV elections</span><span class="w">
</span><span class="n">ctr_elcs</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_edate</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">n_pgv_dates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_distinct</span><span class="p">(</span><span class="n">pgv_next_election_date</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">n_pgv_dates</span><span class="w">  </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 0 x 3
## # Groups:   country_iso3c [0]
## # ‚Ä¶ with 3 variables: country_iso3c &lt;chr&gt;, cmp_edate &lt;date&gt;,
## #   n_pgv_dates &lt;int&gt;</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># ensure that no PGV election maps to multiple CMP elections</span><span class="w">
</span><span class="n">ctr_elcs</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">pgv_next_election_date</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">n_cmp_dates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_distinct</span><span class="p">(</span><span class="n">cmp_edate</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">n_cmp_dates</span><span class="w">  </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 0 x 3
## # Groups:   country_iso3c [0]
## # ‚Ä¶ with 3 variables: country_iso3c &lt;chr&gt;,
## #   pgv_next_election_date &lt;date&gt;, n_cmp_dates &lt;int&gt;</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># inexact (best) matches ? </span><span class="w">
</span><span class="n">ctr_elcs</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">abs_elc_date_diff</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 13 x 4
##    country_iso3c pgv_next_election_date cmp_edate  abs_elc_date_diff
##    &lt;chr&gt;         &lt;date&gt;                 &lt;date&gt;     &lt;time&gt;           
##  1 FRA           1981-06-21             1981-06-14 7 days           
##  2 FRA           1988-06-12             1988-06-05 7 days           
##  3 FRA           1993-03-28             1993-03-21 7 days           
##  4 FRA           1997-06-01             1997-05-25 7 days           
##  5 FRA           2002-06-16             2002-06-09 7 days           
##  6 FRA           2007-06-17             2007-06-10 7 days           
##  7 FRA           2012-06-17             2012-06-10 7 days           
##  8 FRA           2017-06-18             2017-06-11 7 days           
##  9 ITA           1992-04-05             1992-04-06 1 days           
## 10 ITA           1994-03-27             1994-03-28 1 days           
## 11 ITA           2006-04-09             2006-04-10 1 days           
## 12 ITA           2013-02-25             2013-02-24 1 days           
## 13 SWE           1998-09-20             1998-09-21 1 days</code></pre></figure> <p>While we can verify that neither any CMP election maps to multiple PGV elections, nor vice versa, the last query returns some configurations where election dates do not match exactly. But inspecting date differences allows to conclude that all differences are rather small (i.e., ‚â§ 7 days), so there is little reason to put the veracity of this data into question.</p> <p>Having matched CMP and PGV elections, I can construct the link table matching CMP country-elections to PGV country-election-(running-)cabinet configurations:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># take country-election link table ...</span><span class="w">
</span><span class="n">running_cabinets</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ctr_elcs</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># and left-join PGV cabinet info (only info of running cabinets matched)</span><span class="w">
    </span><span class="n">left_join</span><span class="p">(</span><span class="n">pgv_elcs</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"country_iso3c"</span><span class="p">,</span><span class="w"> </span><span class="s2">"pgv_next_election_date"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">rename</span><span class="p">(</span><span class="w">
        </span><span class="n">pgv_election_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pgv_next_election_date</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pgv_cabinet_id</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pgv_cabinet_name</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_start_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pgv_cabinet_start_date</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_election_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pgv_election_date</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">select</span><span class="p">(</span><span class="w">
        </span><span class="n">country_iso3c</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">cmp_edate</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_election_date</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_name</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_id</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_start_date</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_election_date</span><span class="w">
    </span><span class="p">)</span></code></pre></figure> <p>We can validate that I have matched exactly one running cabinet to each CMP election:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># any duplicates?</span><span class="w">
</span><span class="n">running_cabinets</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_edate</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">n_distinct</span><span class="p">(</span><span class="n">pgv_running_cabinet_id</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 0 x 7
## # Groups:   country_iso3c, cmp_edate [0]
## # ‚Ä¶ with 7 variables: country_iso3c &lt;chr&gt;, cmp_edate &lt;date&gt;,
## #   pgv_election_date &lt;date&gt;, pgv_running_cabinet_name &lt;chr&gt;,
## #   pgv_running_cabinet_id &lt;int&gt;,
## #   pgv_running_cabinet_start_date &lt;date&gt;,
## #   pgv_running_cabinet_election_date &lt;date&gt;</code></pre></figure> <h3 id="create-link-table-matching-cmp-and-pgv-party-ids">Create link table matching CMP and PGV party IDs</h3> <p>Now that I‚Äôve solved the first problem (matching running cabinets to the CMP data), I can deal with the other problem: matching PGV to CMP parties. I‚Äôll use the link-table provided by <a href="https://partyfacts.herokuapp.com">PartyFacts</a>. We first download the file:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># define your data dir</span><span class="w">
</span><span class="n">data_dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"path/to/your/data/directory"</span><span class="w">

</span><span class="c1"># download link table</span><span class="w">
</span><span class="n">file_name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"partyfacts-mapping.csv"</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file_name</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">list.files</span><span class="p">(</span><span class="n">data_dir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"https://partyfacts.herokuapp.com/download/external-parties-csv/"</span><span class="w">
    </span><span class="n">download.file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span><span class="w"> </span><span class="n">file_name</span><span class="p">))</span><span class="w">
</span><span class="p">}</span></code></pre></figure> <p>Next, we create a link table matching PGV and CMP party IDs:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># read link table</span><span class="w">
</span><span class="n">ptf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span><span class="w"> </span><span class="n">file_name</span><span class="p">))</span><span class="w">
</span><span class="c1"># NOTE: on 2019-02-23, this raised some warnings, which can be ignored</span><span class="w">

</span><span class="c1"># check if all coiuntries covered in party-facts (PTF) data</span><span class="w">
</span><span class="nf">all</span><span class="p">(</span><span class="n">countries</span><span class="o">$</span><span class="n">country_iso3c</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">ptf</span><span class="o">$</span><span class="n">country</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] TRUE</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># create CMP-PGV party link table</span><span class="w">
</span><span class="n">pty_links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ptf</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># for select countries</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">countries</span><span class="o">$</span><span class="n">country_iso3c</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># take parties CMP IDs</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">dataset_key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"manifesto"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">select</span><span class="p">(</span><span class="n">partyfacts_id</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">dataset_party_id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># inner join drops both CMP parties that have no matching PGV ID,</span><span class="w">
    </span><span class="c1"># and PGV parties for which no matching CMP code exists</span><span class="w">
    </span><span class="n">inner_join</span><span class="p">(</span><span class="w">
        </span><span class="n">ptf</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
            </span><span class="c1"># parties PGV IDs (where possible)</span><span class="w">
            </span><span class="n">filter</span><span class="p">(</span><span class="n">dataset_key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"parlgov"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
            </span><span class="n">select</span><span class="p">(</span><span class="n">partyfacts_id</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">dataset_party_id</span><span class="p">)</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"partyfacts_id"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"partyfacts_id"</span><span class="p">)</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">suffix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"_cmp"</span><span class="p">,</span><span class="w"> </span><span class="s2">"_pgv"</span><span class="p">)</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">country_cmp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">country_pgv</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">country_pgv</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">rename</span><span class="p">(</span><span class="w">
        </span><span class="n">country_iso3c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country_cmp</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">cmp_party</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataset_party_id_cmp</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_party_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataset_party_id_pgv</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">ptf_party_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partyfacts_id</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">mutate_at</span><span class="p">(</span><span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">as.integer</span><span class="p">)</span></code></pre></figure> <p>We get a dataframe with 310 rows, but there are both instances of 1:m and m:1 PGV to CMP party matchings, as the below queries demonstrate:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">nrow</span><span class="p">(</span><span class="n">pty_links</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] 310</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># is distinct?</span><span class="w">
</span><span class="n">is_unique</span><span class="p">(</span><span class="n">pty_links</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] TRUE</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># any PGV ID matches to multiple CMP parties?</span><span class="w">
</span><span class="n">pty_links</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">pgv_party_id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">n_distinct</span><span class="p">(</span><span class="n">cmp_party</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 27 x 4
## # Groups:   pgv_party_id [11]
##    ptf_party_id country_iso3c cmp_party pgv_party_id
##           &lt;int&gt; &lt;chr&gt;             &lt;int&gt;        &lt;int&gt;
##  1          698 BEL               21912          969
##  2          554 BEL               21422          454
##  3          698 BEL               21423          969
##  4          554 BEL               21425          454
##  5           36 BEL               21916          501
##  6           36 BEL               21913          501
##  7         1586 BEL               21221         1113
##  8         1586 BEL               21330         1113
##  9          516 GRC               34020         1441
## 10          516 GRC               34211         1441
## # ‚Ä¶ with 17 more rows</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># any CMP ID matches to multiple PGV parties?</span><span class="w">
</span><span class="n">pty_links</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">cmp_party</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">n_distinct</span><span class="p">(</span><span class="n">pgv_party_id</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 15 x 4
## # Groups:   cmp_party [6]
##    ptf_party_id country_iso3c cmp_party pgv_party_id
##           &lt;int&gt; &lt;chr&gt;             &lt;int&gt;        &lt;int&gt;
##  1          878 ITA               32220          809
##  2          878 ITA               32220         2666
##  3          851 ITA               32110          910
##  4          851 ITA               32110         1304
##  5         4019 ESP               33099         2607
##  6         4019 ESP               33099         2606
##  7         4019 ESP               33099           62
##  8         4019 ESP               33020         2607
##  9         4019 ESP               33020         2606
## 10         4019 ESP               33020           62
## 11         4019 ESP               33098         2607
## 12         4019 ESP               33098         2606
## 13         4019 ESP               33098           62
## 14         1567 GBR               51620          773
## 15         1567 GBR               51620         1496</code></pre></figure> <p>Below we‚Äôll see whether this 1:m and m:1 matching PGV:CMP IDs disappears once we add country-election(-cabinet) info.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># how many matched?</span><span class="w">
</span><span class="n">cmp_elc_ptys</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">left_join</span><span class="p">(</span><span class="n">pty_links</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">summarise</span><span class="p">(</span><span class="w">
        </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">()</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">n_matched</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">pgv_party_id</span><span class="p">))</span><span class="w">
    </span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 1 x 2
##       n n_matched
##   &lt;int&gt;     &lt;int&gt;
## 1  1398      1331</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># any CMP party in data matches to no PGV parties?</span><span class="w">
</span><span class="n">cmp_elc_ptys</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">left_join</span><span class="p">(</span><span class="n">pty_links</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_edate</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_party</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">n_distinct</span><span class="p">(</span><span class="n">pgv_party_id</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 67 x 7
## # Groups:   country_iso3c, cmp_edate, cmp_party [67]
##    country_iso3c cmp_edate  cmp_party cmp_partyname cmp_partyabbrev
##    &lt;chr&gt;         &lt;date&gt;         &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;          
##  1 FIN           1991-03-17     14223 Left Wing Al‚Ä¶ VAS            
##  2 FIN           1995-03-19     14223 Left Wing Al‚Ä¶ VAS            
##  3 FIN           1999-03-21     14223 Left Wing Al‚Ä¶ VAS            
##  4 FIN           2003-03-16     14223 Left Wing Al‚Ä¶ VAS            
##  5 FIN           2007-03-18     14223 Left Wing Al‚Ä¶ VAS            
##  6 FIN           2011-04-17     14223 Left Wing Al‚Ä¶ VAS            
##  7 BEL           2007-06-10     21917 Flemish Inte‚Ä¶ VB             
##  8 BEL           2010-06-13     21917 Flemish Inte‚Ä¶ VB             
##  9 NLD           1982-09-08     22710 Centre Party  ""             
## 10 NLD           1994-05-03     22955 Union 55+     Unie 55+       
## # ‚Ä¶ with 57 more rows, and 2 more variables: ptf_party_id &lt;int&gt;,
## #   pgv_party_id &lt;int&gt;</code></pre></figure> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># any CMP party in data matches to multiple PGV parties?</span><span class="w">
</span><span class="n">cmp_elc_ptys</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">left_join</span><span class="p">(</span><span class="n">pty_links</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_edate</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_party</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">n_distinct</span><span class="p">(</span><span class="n">pgv_party_id</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 52 x 7
## # Groups:   country_iso3c, cmp_edate, cmp_party [24]
##    country_iso3c cmp_edate  cmp_party cmp_partyname cmp_partyabbrev
##    &lt;chr&gt;         &lt;date&gt;         &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;          
##  1 ITA           1983-06-26     32220 Italian Comm‚Ä¶ PCI            
##  2 ITA           1983-06-26     32220 Italian Comm‚Ä¶ PCI            
##  3 ITA           1987-06-14     32110 Green Federa‚Ä¶ FdV            
##  4 ITA           1987-06-14     32110 Green Federa‚Ä¶ FdV            
##  5 ITA           1987-06-14     32220 Italian Comm‚Ä¶ PCI            
##  6 ITA           1987-06-14     32220 Italian Comm‚Ä¶ PCI            
##  7 ITA           1992-04-06     32110 Green Federa‚Ä¶ FdV            
##  8 ITA           1992-04-06     32110 Green Federa‚Ä¶ FdV            
##  9 ITA           1992-04-06     32220 Democratic P‚Ä¶ PDS            
## 10 ITA           1992-04-06     32220 Democratic P‚Ä¶ PDS            
## # ‚Ä¶ with 42 more rows, and 2 more variables: ptf_party_id &lt;int&gt;,
## #   pgv_party_id &lt;int&gt;</code></pre></figure> <p>We see that there exist no matching PGV party IDs for some configurations in the CMP data. Note, however, that this is problematic only insofar as we want to get the government status info from PGV: if we cannot match a PGV party to a CMP party, we cannot say whether the given (unmatched) CMP party was in government or not.</p> <p>I‚Äôll deal with this problem in the next step. Specifically, I‚Äôll check if further matching efforts need to be undertaken in case we cannot match all gov‚Äôt parties in a configuration</p> <h3 id="check-if-all-govt-parties-can-be-matched">Check if all gov‚Äôt parties can be matched</h3> <p>First, we enrich the CMP data by PGV party IDs (where possible) as provided in the link table.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">cmp_w_pgv_ids</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cmp_elc_ptys</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">left_join</span><span class="p">(</span><span class="n">pty_links</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"country_iso3c"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cmp_party"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">ptf_party_id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_edate</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_party</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">cmp_n_pgv_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_distinct</span><span class="p">(</span><span class="n">pgv_party_id</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">ungroup</span><span class="p">()</span></code></pre></figure> <p>Then we right-join party information from the PGV cabinets view to the dataset containing running cabinet info (<code class="highlighter-rouge">running_cabinets</code>) created above.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># create running-cabinet party-level dataset</span><span class="w">
</span><span class="n">running_parties</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cabs</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># select party-cabinet info from original PGV cabinets view</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="w">
        </span><span class="n">country_name_short</span><span class="p">,</span><span class="w"> </span><span class="n">cabinet_id</span><span class="p">,</span><span class="w">
        </span><span class="n">party_id</span><span class="p">,</span><span class="w"> </span><span class="n">party_name_english</span><span class="p">,</span><span class="w"> </span><span class="n">party_name_short</span><span class="p">,</span><span class="w">
        </span><span class="n">caretaker</span><span class="p">,</span><span class="w"> </span><span class="n">cabinet_party</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="c1"># add party CMP ID (where exists) from original PGV parties view</span><span class="w">
    </span><span class="n">left_join</span><span class="p">(</span><span class="w">
        </span><span class="n">ptys</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">party_id</span><span class="p">,</span><span class="w"> </span><span class="n">cmp</span><span class="p">)</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"party_id"</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="c1"># compute cabinet size</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country_name_short</span><span class="p">,</span><span class="w"> </span><span class="n">cabinet_id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">cabinet_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">cabinet_party</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># add prefixes to all but the first column</span><span class="w">
    </span><span class="n">rename_at</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"pgv_"</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="c1"># join only running cabinets</span><span class="w">
    </span><span class="n">right_join</span><span class="p">(</span><span class="w">
        </span><span class="n">running_cabinets</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w">
            </span><span class="s2">"country_name_short"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"country_iso3c"</span><span class="w">
            </span><span class="p">,</span><span class="w"> </span><span class="s2">"pgv_cabinet_id"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pgv_running_cabinet_id"</span><span class="w">
        </span><span class="p">)</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># rename</span><span class="w">
    </span><span class="n">rename</span><span class="p">(</span><span class="w">
        </span><span class="n">country_iso3c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country_name_short</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pgv_cabinet_id</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># select columns</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="w">
        </span><span class="c1"># all columns as ordered in `running_cabinets` dataframe</span><span class="w">
        </span><span class="o">!!</span><span class="nf">names</span><span class="p">(</span><span class="n">running_cabinets</span><span class="p">)</span><span class="w">
        </span><span class="c1"># other columns ...</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_cabinet_size</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_caretaker</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_party_name_short</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_party_name_english</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_party_id</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_cabinet_party</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_cmp</span><span class="w">
    </span><span class="p">)</span></code></pre></figure> <p>Now we are ready to join the information on running cabinet parties to the CMP dataset. We use PGV party IDs, keeping in mind that there is a subset of parties in the CMP data for which we could not identify a matching PGV party.</p> <p>Specifically, we perform a full outer join which gives us a stacked version of the CMP and PGV data, containing:</p> <ol> <li>all matching country-election-party pairings</li> <li>all non-matching country-election-parties from the CMP data</li> <li>all non-matching country-election-parties from the PGV data</li> </ol> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># join PGV party-level data to PGV-ID-enriched CMP country-election-party data</span><span class="w">
</span><span class="n">cmp_full_join_pgv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cmp_w_pgv_ids</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># add running parties (full outer join!)</span><span class="w">
    </span><span class="n">full_join</span><span class="p">(</span><span class="n">running_parties</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"country_iso3c"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cmp_edate"</span><span class="p">,</span><span class="w"> </span><span class="s2">"pgv_party_id"</span><span class="p">))</span><span class="w"> </span></code></pre></figure> <p>We can better understand the structure of the resulting dataset by inspecting an example configuration:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># inspect an example configuration</span><span class="w">
</span><span class="n">cmp_full_join_pgv</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">country_iso3c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"BEL"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">pgv_election_date</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"2007-06-10"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cmp_edate</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"2007-06-10"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">select</span><span class="p">(</span><span class="w">
        </span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_edate</span><span class="p">,</span><span class="w"> 
        </span><span class="n">pgv_running_cabinet_name</span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_start_date</span><span class="p">,</span><span class="w"> 
        </span><span class="n">cmp_partyabbrev</span><span class="p">,</span><span class="w"> </span><span class="n">pgv_party_name_short</span><span class="w">
    </span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 15 x 6
##    country_iso3c cmp_edate  pgv_running_cab‚Ä¶ pgv_running_cab‚Ä¶
##    &lt;chr&gt;         &lt;date&gt;     &lt;chr&gt;            &lt;date&gt;          
##  1 BEL           2007-06-10 Verhofstadt II   2003-07-12      
##  2 BEL           2007-06-10 &lt;NA&gt;             NA              
##  3 BEL           2007-06-10 Verhofstadt II   2003-07-12      
##  4 BEL           2007-06-10 &lt;NA&gt;             NA              
##  5 BEL           2007-06-10 Verhofstadt II   2003-07-12      
##  6 BEL           2007-06-10 Verhofstadt II   2003-07-12      
##  7 BEL           2007-06-10 Verhofstadt II   2003-07-12      
##  8 BEL           2007-06-10 Verhofstadt II   2003-07-12      
##  9 BEL           2007-06-10 &lt;NA&gt;             NA              
## 10 BEL           2007-06-10 Verhofstadt II   2003-07-12      
## 11 BEL           2007-06-10 Verhofstadt II   2003-07-12      
## 12 BEL           2007-06-10 Verhofstadt II   2003-07-12      
## 13 BEL           2007-06-10 &lt;NA&gt;             NA              
## 14 BEL           2007-06-10 Verhofstadt II   2003-07-12      
## 15 BEL           2007-06-10 Verhofstadt II   2003-07-12      
## # ‚Ä¶ with 2 more variables: cmp_partyabbrev &lt;chr&gt;,
## #   pgv_party_name_short &lt;chr&gt;</code></pre></figure> <p>In this example, the Belgian ‚ÄòVerhofstadt II‚Äô cabinet (PGV naming) taking office on 2003-07-12, parties ‚ÄòVB‚Äô and ‚ÄòFN‚Äô in the PGV data could not be matched to any party within this country-election configuration in the CMP dataset when using PGV party IDs (as obtained from the party-facts link table). Conversely, parties ‚Äògroen!‚Äô, ‚Äòsp.a‚Äô, ‚ÄòLDD‚Äô and ‚ÄòVB‚Äô in the CMP dataset could not be matched to any party within this country-election configuration in the PGV data. Significantly, despite ‚ÄòVB‚Äô exists in both datasets, the CMP ‚ÄòVB‚Äô could not be matched to the PGV ‚ÄòVB‚Äô because the PGV party ID obtained trough the party-facts link table mismatches the one used in the original PGV data.</p> <p>What‚Äôs more is that CMP parties for which no PGV party could be matched using PGV party IDs have <code class="highlighter-rouge">NA</code>s on columns originating from the PGV data frame, and vice versa. So we want to fill-in missing information. I will do this by imputing missings from configuration context where possible.<sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup></p> <p>That‚Äôs what I do next:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># fill-in missing information by inferring from configuration's contexts</span><span class="w">
</span><span class="n">cmp_full_join_pgv_filled</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cmp_full_join_pgv</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># a) take PGV country-election groupings ...</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">pgv_election_date</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1">#    ... fill-in missing CMP election date (can be inferred from grouping)</span><span class="w">
    </span><span class="n">fill</span><span class="p">(</span><span class="n">cmp_edate</span><span class="p">,</span><span class="w"> </span><span class="n">.direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"up"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">fill</span><span class="p">(</span><span class="n">cmp_edate</span><span class="p">,</span><span class="w"> </span><span class="n">.direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"down"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="c1">#    ... and remove PGV configurations that are completly missing in CMP data (if any)</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">cmp_edate</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># should be all</span><span class="w">
    </span><span class="c1"># b) take CMP country-election groupings ...</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_edate</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1">#    ... and fill-in missing but inferrable PGV info</span><span class="w">
    </span><span class="n">fill</span><span class="p">(</span><span class="w">
        </span><span class="n">pgv_election_date</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_start_date</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_name</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_id</span><span class="w"> 
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_election_date</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_cabinet_size</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_caretaker</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">.direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"down"</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">fill</span><span class="p">(</span><span class="w">
        </span><span class="n">pgv_election_date</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_start_date</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_name</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_id</span><span class="w"> 
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_election_date</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_cabinet_size</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_caretaker</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">.direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"up"</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">ungroup</span><span class="p">()</span></code></pre></figure> <p>The result of filling-in missing but inferable information from the context gives complete configuration for which we know which CMP party is non-matching in PGV data and vice versa:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">cmp_full_join_pgv_filled</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">country_iso3c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"BEL"</span><span class="p">,</span><span class="w">  </span><span class="n">cmp_edate</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"2007-06-10"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">select</span><span class="p">(</span><span class="w">
        </span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_edate</span><span class="p">,</span><span class="w"> 
        </span><span class="n">pgv_running_cabinet_name</span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_start_date</span><span class="p">,</span><span class="w"> 
        </span><span class="n">cmp_partyabbrev</span><span class="p">,</span><span class="w"> </span><span class="n">pgv_party_name_short</span><span class="p">,</span><span class="w">
        </span><span class="n">pgv_cabinet_size</span><span class="p">,</span><span class="w"> </span><span class="n">pgv_cabinet_party</span><span class="w">
    </span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 15 x 8
##    country_iso3c cmp_edate  pgv_running_cab‚Ä¶ pgv_running_cab‚Ä¶
##    &lt;chr&gt;         &lt;date&gt;     &lt;chr&gt;            &lt;date&gt;          
##  1 BEL           2007-06-10 Verhofstadt II   2003-07-12      
##  2 BEL           2007-06-10 Verhofstadt II   2003-07-12      
##  3 BEL           2007-06-10 Verhofstadt II   2003-07-12      
##  4 BEL           2007-06-10 Verhofstadt II   2003-07-12      
##  5 BEL           2007-06-10 Verhofstadt II   2003-07-12      
##  6 BEL           2007-06-10 Verhofstadt II   2003-07-12      
##  7 BEL           2007-06-10 Verhofstadt II   2003-07-12      
##  8 BEL           2007-06-10 Verhofstadt II   2003-07-12      
##  9 BEL           2007-06-10 Verhofstadt II   2003-07-12      
## 10 BEL           2007-06-10 Verhofstadt II   2003-07-12      
## 11 BEL           2007-06-10 Verhofstadt II   2003-07-12      
## 12 BEL           2007-06-10 Verhofstadt II   2003-07-12      
## 13 BEL           2007-06-10 Verhofstadt II   2003-07-12      
## 14 BEL           2007-06-10 Verhofstadt II   2003-07-12      
## 15 BEL           2007-06-10 Verhofstadt II   2003-07-12      
## # ‚Ä¶ with 4 more variables: cmp_partyabbrev &lt;chr&gt;,
## #   pgv_party_name_short &lt;chr&gt;, pgv_cabinet_size &lt;int&gt;,
## #   pgv_cabinet_party &lt;int&gt;</code></pre></figure> <p>So now we are ready to again deal with the core problem: the fact that we cannot match PGV party info to some CMP parties. This fact is problematic for our purpose (identifying parties‚Äô government status) <em>if and only if</em> not all PGV parties that are recorded as cabinet party for a given configuration can be matched. This is because if we can match all cabinet parties, we can infer the government status of non-matched parties: they are all not cabinet parties.</p> <p>A straight-forward way to validate this condition is to try to replicate the <code class="highlighter-rouge">cabinet_size</code> measure. The logic is simple: For configurations in which aggregating party cabinet membership information at the country-election(-cabinet) level does not allow us to replicate this measure, we know that we failed to match at least one government party. In such a case, we could only infer the missing government status information if only one party in this configuration was not matched. Otherwise, we would not have enough information to infer non-matching parties government status.</p> <p>So I check this in the dataset <code class="highlighter-rouge">cmp_full_join_pgv_filled</code>:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">cmp_full_join_pgv_filled</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_edate</span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_start_date</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="w">
        </span><span class="n">postmatch_cabinet_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_distinct</span><span class="p">(</span><span class="n">ifelse</span><span class="p">(</span><span class="n">pgv_cabinet_party</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">pgv_party_name_short</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pgv_cabinet_size</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">postmatch_cabinet_size</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 0 x 20
## # Groups:   country_iso3c, cmp_edate, pgv_running_cabinet_start_date
## #   [0]
## # ‚Ä¶ with 20 variables: country_iso3c &lt;chr&gt;, cmp_edate &lt;date&gt;,
## #   cmp_party &lt;dbl&gt;, cmp_partyname &lt;chr&gt;, cmp_partyabbrev &lt;chr&gt;,
## #   pgv_party_id &lt;int&gt;, cmp_n_pgv_ids &lt;int&gt;,
## #   pgv_election_date &lt;date&gt;, pgv_running_cabinet_name &lt;chr&gt;,
## #   pgv_running_cabinet_id &lt;int&gt;,
## #   pgv_running_cabinet_start_date &lt;date&gt;,
## #   pgv_running_cabinet_election_date &lt;date&gt;, pgv_cabinet_size &lt;int&gt;,
## #   pgv_caretaker &lt;int&gt;, pgv_party_name_short &lt;chr&gt;,
## #   pgv_party_name_english &lt;chr&gt;, pgv_cabinet_party &lt;int&gt;,
## #   pgv_cmp &lt;int&gt;, postmatch_cabinet_size &lt;int&gt;, flag &lt;lgl&gt;</code></pre></figure> <p>Wow! We are lucky: I was able to replicate the <code class="highlighter-rouge">cabinet_size</code> measure for all configurations in the dataset, and hence can infer that parties that could not be matched are invariable opposition parties.<sup id="fnref:4"><a href="#fn:4" class="footnote">4</a></sup></p> <h3 id="create-the-complete-dataset">Create the complete dataset</h3> <p>Now I have almost reached my goal. The final step is to add the inferred government status information (i.e., replace <code class="highlighter-rouge">NA</code> values with <code class="highlighter-rouge">0</code>), drop PGV parties that are non-matching in the CMP data, and gather all datasets at the level of CMP country-election-party configurations.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># take the filled-in fully-joined dataset</span><span class="w">
</span><span class="n">cmp_w_pty_govt_status</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cmp_full_join_pgv_filled</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># get rid of PGV parties that are non-matching in CMP data</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">cmp_party</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># infer missing government status by ...</span><span class="w">
    </span><span class="c1"># ... a) looking within CMP country-election-party configurations, and</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country_iso3c</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_edate</span><span class="p">,</span><span class="w"> </span><span class="n">cmp_party</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">fill</span><span class="p">(</span><span class="n">pgv_cabinet_party</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># ... b) replace with 0 where still NA</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">pgv_cabinet_party</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">pgv_cabinet_party</span><span class="p">),</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">pgv_cabinet_party</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># aggregate at party-level within CMP data</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="w">
        </span><span class="n">country_iso3c</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">cmp_edate</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_name</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_id</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_start_date</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_running_cabinet_election_date</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_cabinet_size</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_caretaker</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">cmp_party</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">cmp_partyname</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">cmp_partyabbrev</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="n">pgv_cabinet_party</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="c1"># add informative comments</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="w">
        </span><span class="n">comment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">case_when</span><span class="p">(</span><span class="w">
            </span><span class="n">cmp_n_pgv_ids</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"no matching party found within matching ParlGov cabinet configuration"</span><span class="w">
            </span><span class="p">,</span><span class="w"> </span><span class="n">cmp_n_pgv_ids</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sprintf</span><span class="p">(</span><span class="w">
                </span><span class="s2">"CMP party matches to party %s (%s) within ParlGov cabinet configuration"</span><span class="w">
                </span><span class="p">,</span><span class="w"> </span><span class="n">if_na</span><span class="p">(</span><span class="n">pgv_party_name_short</span><span class="p">,</span><span class="w"> </span><span class="s2">"?"</span><span class="p">)</span><span class="w">
                </span><span class="p">,</span><span class="w"> </span><span class="n">if_na</span><span class="p">(</span><span class="n">pgv_party_id</span><span class="p">,</span><span class="w"> </span><span class="s2">"?"</span><span class="p">)</span><span class="w">
            </span><span class="p">)</span><span class="w">
            </span><span class="p">,</span><span class="w"> </span><span class="n">cmp_n_pgv_ids</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sprintf</span><span class="p">(</span><span class="w">
                </span><span class="s2">"CMP party matches to multiple parties within ParlGov cabinet configuration: %s"</span><span class="w">
                </span><span class="p">,</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="w">
                    </span><span class="n">sprintf</span><span class="p">(</span><span class="w">
                        </span><span class="s2">"%s (%s)"</span><span class="w">
                        </span><span class="p">,</span><span class="w"> </span><span class="n">if_na</span><span class="p">(</span><span class="n">pgv_party_name_short</span><span class="p">,</span><span class="w"> </span><span class="s2">"?"</span><span class="p">)</span><span class="w">
                        </span><span class="p">,</span><span class="w"> </span><span class="n">if_na</span><span class="p">(</span><span class="n">pgv_party_id</span><span class="p">,</span><span class="w"> </span><span class="s2">"?"</span><span class="p">)</span><span class="w">
                    </span><span class="p">)</span><span class="w">
                    </span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">", "</span><span class="w">
                </span><span class="p">)</span><span class="w">
            </span><span class="p">)</span><span class="w">
            </span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="kc">NA_character_</span><span class="w">
        </span><span class="c1"># in order to aggregate, keep distinct comments (always 1 within grouping)</span><span class="w">
        </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">unique</span><span class="p">()</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">ungroup</span><span class="p">()</span></code></pre></figure> <p>We can verify that we have added valid government status information to every row in the original CMP dataset:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">nrow</span><span class="p">(</span><span class="n">cmp_w_pty_govt_status</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">cmp</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] TRUE</code></pre></figure> <p>The resulting dataset contains just everything we need to join it back to the original CMP dataset <code class="highlighter-rouge">cmp_raw</code> ‚Ä¶</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">head</span><span class="p">(</span><span class="n">cmp_w_pty_govt_status</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 6 x 13
##   country_iso3c cmp_edate  pgv_running_cab‚Ä¶ pgv_running_cab‚Ä¶
##   &lt;chr&gt;         &lt;date&gt;     &lt;chr&gt;                       &lt;int&gt;
## 1 AUT           1983-04-24 Kreisky IV                    463
## 2 AUT           1983-04-24 Kreisky IV                    463
## 3 AUT           1983-04-24 Kreisky IV                    463
## 4 AUT           1986-11-23 Vranitzky I                   828
## 5 AUT           1986-11-23 Vranitzky I                   828
## 6 AUT           1986-11-23 Vranitzky I                   828
## # ‚Ä¶ with 9 more variables: pgv_running_cabinet_start_date &lt;date&gt;,
## #   pgv_running_cabinet_election_date &lt;date&gt;, pgv_cabinet_size &lt;int&gt;,
## #   pgv_caretaker &lt;int&gt;, cmp_party &lt;dbl&gt;, cmp_partyname &lt;chr&gt;,
## #   cmp_partyabbrev &lt;chr&gt;, pgv_cabinet_party &lt;dbl&gt;, comment &lt;chr&gt;</code></pre></figure> <p>‚Ä¶ but I leave this exercise to you üòä</p> <div class="footnotes"> <ol> <li id="fn:1"> <p>But see the <a href="https://manifesto-project.wzb.eu/down/data/2018b/codebooks/codebook_MPDataset_MPDS2018b.pdf">indicator <code class="highlighter-rouge">progtype</code></a> in the CMP data, distinguishing different techniques of obtaining policy position measurements.¬†<a href="#fnref:1" class="reversefootnote">‚Ü©</a></p> </li> <li id="fn:2"> <p>See https://manifesto-project.wzb.eu/information/documents/api for detailed information on the API.¬†<a href="#fnref:2" class="reversefootnote">‚Ü©</a></p> </li> <li id="fn:3"> <p>In the example of ‚ÄòVerhofstadt II‚Äô cabinet, we know, for instance, that we can write ‚ÄòVerhofstadt II‚Äô in column <code class="highlighter-rouge">pgv_running_cabinet_name</code> where there are currently <code class="highlighter-rouge">NA</code>s because we matched PGV to CMP data using our country-election date look-up table, and we know that we have selected only one cabinet configuration per election from the PGV data (the ‚Äòrunning‚Äô cabinet). Hence there are no ambiguities at the election-cabinet level.¬†<a href="#fnref:3" class="reversefootnote">‚Ü©</a></p> </li> <li id="fn:4"> <p>In case you wonder about the clumsy definition of column <code class="highlighter-rouge">postmatch_cabinet_size</code>: Since some PGV parties match to multiple CMP parties, I need to count distinct PGV parties to exactly replicate the <code class="highlighter-rouge">cabinet_size</code> measure. If I would instead have used <code class="highlighter-rouge">postmatch_cabinet_size = sum(pgv_cabinet_party, na.rm = NA)</code>, the indicator would have double counted m:1 matched CMP parties, and in these cases <code class="highlighter-rouge">postmatch_cabinet_size &gt; pgv_cabinet_size</code>.¬†<a href="#fnref:4" class="reversefootnote">‚Ü©</a></p> </li> </ol> </div> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="http://localhost:4000/tags/#data%20wrangling" title="Pages tagged data wrangling" class="tag"><span class="term">data wrangling</span></a><a href="http://localhost:4000/tags/#tidyverse" title="Pages tagged tidyverse" class="tag"><span class="term">tidyverse</span></a><a href="http://localhost:4000/tags/#parties" title="Pages tagged parties" class="tag"><span class="term">parties</span></a><a href="http://localhost:4000/tags/#policy%20positions" title="Pages tagged policy positions" class="tag"><span class="term">policy positions</span></a><a href="http://localhost:4000/tags/#party%20data" title="Pages tagged party data" class="tag"><span class="term">party data</span></a><a href="http://localhost:4000/tags/#manifestos" title="Pages tagged manifestos" class="tag"><span class="term">manifestos</span></a><a href="http://localhost:4000/tags/#CMP" title="Pages tagged CMP" class="tag"><span class="term">CMP</span></a><a href="http://localhost:4000/tags/#Parlgov" title="Pages tagged Parlgov" class="tag"><span class="term">Parlgov</span></a><a href="http://localhost:4000/tags/#merging" title="Pages tagged merging" class="tag"><span class="term">merging</span></a><a href="http://localhost:4000/tags/#joining" title="Pages tagged joining" class="tag"><span class="term">joining</span></a><a href="http://localhost:4000/tags/#merge" title="Pages tagged merge" class="tag"><span class="term">merge</span></a><a href="http://localhost:4000/tags/#join" title="Pages tagged join" class="tag"><span class="term">join</span></a><a href="http://localhost:4000/tags/#missing%20data" title="Pages tagged missing data" class="tag"><span class="term">missing data</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/merge-cmp-and-pgv-data/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/merge-cmp-and-pgv-data/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <!-- <a href="https://plus.google.com/share?url=http://localhost:4000/merge-cmp-and-pgv-data/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> --> </span> <div style="clear:both"></div> </div> </div> </div> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <!-- MathJax --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } }); </script> <script type="text/javascript" charset="utf-8" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script> <script type="text/javascript" charset="utf-8" src="https://vincenttam.github.io/javascripts/MathJaxLocal.js"> </script> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
